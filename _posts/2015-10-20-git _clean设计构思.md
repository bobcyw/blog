---
layout: Blog Template for Bootstrap
title: git_clean设计构思
description: 从用户设计, 内部设计和隐喻设计三个方面,介绍git_clean的设计思路
---
## 现状  
现在开源软件已经成为了时尚,但很多时候私有软件想开源,却面临大量的密钥,密码和内部信息文件需要清理.  

### 目前的解决办法  
1. git branch-filter  
2. BFG  

这两个办法都需要指定文件名称,同时都是命令行模式.    
现状,很多清理的时候并不知道文件名称,很多敏感信息都散落在各个文件里,只知道一些信息的特征,但不知道名字,比如rsa密钥都包含-----BEGIN RSA PRIVATE KEY-----这样的字符串,而包含了password,密码这样字符串的信息都必须小心处理.
现有的上述两种工具并不提供检索功能.  

## 所以git_clean应运而生.  

### 用户使用设计  

借鉴现在的docker和AWS描述方式,软件行为定义用一个配置文件来定义,方便复用和修改.  
配置文件的格式优先选择yaml,这个格式结构比json更简洁.  
用户有三种描述需要删除文件的方式,指定文件,指定目录,指定特征值.  
从执行的角度,参考2to3,有只输出报告,和真实删除两种模式.
从git角度看,由于子模块的存在,每个模块的配置文件可能不同.所以,配置文件也应该像树一样有节点.彼此可以连接.  

### 内部细节设计  
路径表述,参考git的设计,路径全部使用相对路径.所以衍生出每个配置文件的"根目录"指定问题.这个问题在设计初期使用直接指定的方法,但在后来的使用过程中,感觉很啰嗦,化简思考后,把显示指定目录改为隐性指定目录,转成隐喻设计.  
指定特征值的方式,可能把一些不该删除的文件也删除掉,比如配置文件本身.或者某些不想删除的文件  

### 隐喻设计  
这里的隐喻设计特指虽然可以把接口暴露给用户,让用户定义,但有符合用户潜意识的定义模式,于是优先使用符合用户潜意识的模式.  
配置文件管理指定的"根目录",大部分情况,把配置文件放在哪个目录下,就表示对哪个目录生效,这是常见的表述方式,用户已经形成习惯,所以在配置文件里再指定"根目录"是画蛇添足的,扭曲的指定,也让用户不能按照习惯使用.  
默认操作并不删除文件,而只是给出要删除文件的报告,这方便新手用户,在不知情的情况下也不会误删文件.  
