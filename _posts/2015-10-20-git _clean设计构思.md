---
layout: Blog Template for Bootstrap
title: git_clean设计构思
excerpt: 从用户设计, 内部设计和隐喻设计三个方面,介绍git_clean的设计思路
---
![github](/blog/pic/github.jpeg)[github](https://github.com/bobcyw/git_cleaner)

## 现状  
现在开源软件已经成为了趋势,很多时候私有软件开源,面临大量敏感文件需要清理(密钥,密码和内部信息).  

#### 目前的解决办法  
* git branch-filter

> <sup>git自带的清理命令,可以回溯删除所有commite里包含的指定文件或者目录</sup>

* BFG

> <sup>git branch-filter的升级版,可以删除超出指定大小的文件,比如意外加入的过大的图片等</sup>


这两个办法都需要指定文件名称,都是命令行模式,BFG也没有对删除尺寸较小的敏感文件给出解决方案.

#### 痛点

很多清理的时候并不知道文件名称,很多敏感信息都散落在各个文件里,只知道一些信息的特征,但不知道名字,比如rsa密钥都包含-----BEGIN RSA PRIVATE KEY-----这样的字符串,而包含了password,密码这样字符串的信息都必须小心处理.
现有的上述两种工具并不提供检索功能.  

## git_clean应运而生

> <sup>git_clean功能同样是删除git里不应该有的敏感数据,它主要提供了文件配置,以及特征值检索的功能,由于使用配置文件还衍生出可以对不同目录进行不同的清理.</sup>

#### 用户使用设计  

* 借鉴现在的docker和AWS描述方式,软件行为定义用一个配置文件来定义,方便复用和修改.  
* 配置文件的格式优先选择yaml<sup>[简明教程](http://docs.saltstack.cn/zh_CN/latest/topics/yaml/index.html),[官方链接](http://yaml.org/)</sup>,这个格式结构比json更简洁.  
* 用户有三种描述需要删除文件的方式,指定文件,指定目录,指定文件的特征值.![选择演示](/blog/pic/git_cleaner选择演示.png)
* 从执行的角度,参考python的2to3模块,有只输出报告,和真实删除两种模式.
* 从git角度看,由于子模块的存在,每个模块的配置文件可能不同.所以,配置文件也应该像树一样有节点.彼此可以连接.![子目录配置](/blog/pic/get_clean子目录说明.png)  

#### 内部细节设计

* 文件的路径表述,参考git的设计,路径全部使用相对路径.进而衍生出每个配置文件的"根目录"指定问题.这个问题在设计初期使用直接指定的方法,但在后来的使用过程中,感觉很啰嗦,化简思考后,把显示指定目录改为隐性指定目录,转成[隐喻设计](#隐喻设计).  
* 指定特征值的方式,可能把一些不该删除的文件也删除掉,比如配置文件本身.或者某些不想删除的文件,遇到这种情况,需要有字段专门说明需要排除的文件  

<h4 id="隐喻设计">隐喻设计</h4>

> <sup>此处的隐喻设计特指某种潜意识设计,即用户不用学习和理解,通过跟以往经验进行对比就能直接理解的设计</sup>

* 配置文件管理指定的"根目录",大部分情况,把配置文件放在哪个目录下,就表示对哪个目录生效,这种常见的表述方式,用户已经形成习惯,所以在配置文件里指定"根目录"没有必要,徒添用户额外的学习负担.  
* 默认操作并不删除文件,而只是给出要删除文件的报告,这方便新手用户,在不知情的情况下也不会误删文件.  
